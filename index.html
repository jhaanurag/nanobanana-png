<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>nanobanana-png — hello</title>
    <style>
      body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; padding: 2rem; }
      .container { max-width: 620px; margin: 0 auto; }
      .message { font-size: 1.4rem; color: #0b4; }
      .error { color: #c00; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>FastAPI /hello demo</h1>
      <p id="status">Loading message…</p>
      <pre id="json" style="display:none; background:#f8f8f8; padding:10px; border-radius:6px;"></pre>

      <hr />
      <h2>Generate image</h2>
      <label for="prompt">Prompt</label>
      <textarea id="prompt" rows="3" style="width:100%;" placeholder="Describe what you want generated, for example: a small banana character with sunglasses"></textarea>
      <div style="margin-top: 8px; display:flex; gap:8px; align-items:center;">
        <button id="generate">Generate</button>
        <span id="gen_status"></span>
      </div>
      <div id="result" style="margin-top: 12px;">
        <div style="font-size: 0.9rem; color: #666;">Result:</div>
        <div style="background: linear-gradient(45deg, #eee 25%, transparent 25%), linear-gradient(-45deg, #eee 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #eee 75%), linear-gradient(-45deg, transparent 75%, #eee 75%); background-size: 16px 16px; background-position: 0 0, 8px 0, 8px -8px, 0px 8px; width:320px; height:240px; display:flex; align-items:center; justify-content:center;">
          <img id="generatedImage" style="max-width:100%; max-height:100%;" alt="Generated image will appear here" />
        </div>
      </div>
    </div>

    <script>
      async function fetchHello() {
        const statusEl = document.getElementById('status');
        const jsonEl = document.getElementById('json');
        try {
          const res = await fetch('/hello', { cache: 'no-store' });
          if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
          const data = await res.json();
          statusEl.innerHTML = '';
          jsonEl.style.display = 'block';
          jsonEl.textContent = JSON.stringify(data, null, 2);
          const m = document.createElement('div');
          m.className = 'message';
          m.textContent = data.message ?? 'no message';
          statusEl.appendChild(m);
        } catch (err) {
          statusEl.className = 'error';
          statusEl.textContent = 'Failed to fetch /hello: ' + err.message;
          jsonEl.style.display = 'none';
        }
      }
      window.addEventListener('DOMContentLoaded', fetchHello);
      document.addEventListener('DOMContentLoaded', () => {
        const generateBtn = document.getElementById('generate');
        const promptEl = document.getElementById('prompt');
        const statusEl = document.getElementById('gen_status');
        const imgEl = document.getElementById('generatedImage');
        generateBtn.addEventListener('click', async () => {
          const prompt = promptEl.value.trim();
          imgEl.src = '';
          statusEl.textContent = '';
          if (!prompt) { statusEl.textContent = 'Please enter a prompt'; return; }
          statusEl.textContent = 'Generating...';
          try {
            const res = await fetch('/generate', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ prompt })
            });
            if (!res.ok) {
              const err = await res.json().catch(() => ({ detail: res.statusText }));
              statusEl.textContent = 'Error: ' + (err.detail || res.statusText);
              return;
            }
            const blob = await res.blob();
            imgEl.src = URL.createObjectURL(blob);
            statusEl.textContent = 'Done';
          } catch (err) {
            statusEl.textContent = 'Failed: ' + err.message;
          }
        });
      });
    </script>
  </body>
</html>
